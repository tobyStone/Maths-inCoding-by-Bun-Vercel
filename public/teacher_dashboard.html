<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard</title>
    <link href="/style.css" rel="stylesheet">
    <style>
        /* Styling for the dashboard */
        body {
            font-family: Arial, sans-serif;
        }

        .student-container {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
        }

        .quiz-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }

        .yellow {
            background-color: yellow;
        }

        .orange {
            background-color: orange;
        }

        .red {
            background-color: red;
        }

        .passed {
            color: green;
            font-weight: bold;
        }

        .failed {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header class="SiteHeader">
        <h1>Maths inCoding Dashboard</h1>
        <div id="missionStatement"><h3>... learning maths through coding computer games</h3></div>
    </header>

    <!-- Dashboard Container -->
    <div id="dashboard">
        <h2>Teacher Dashboard</h2>
        <div id="results">Loading...</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        async function fetchUpdatedDashboardData() {
            try {
                const response = await axios.get('/repeat_teacher_dashboard');
                if (response.status !== 200) {
                    throw new Error('Unable to load dashboard data');
                }

                // Update the results dynamically
                const data = response.data;
                const resultsContainer = document.getElementById('results');
                resultsContainer.innerHTML = ''; // Clear existing content

                Object.values(data).forEach(student => {
                    const studentContainer = document.createElement('div');
                    studentContainer.classList.add('student-container');
                    studentContainer.innerHTML = `
                            <div><strong>${student.studentName} (${student.email})</strong></div>
                            <div class="quiz-results">
                                ${Object.entries(student.scores).map(([quizId, result]) => `
                                    <div class="quiz-result ${result.count >= 3 ? 'red' : result.count === 2 ? 'orange' : 'yellow'}">
                                        Quiz: ${quizId} - ${result.count} ${result.count === 1 ? 'failure' : 'failures'} - Last Date: ${result.dates[result.dates.length - 1]}
                                    </div>
                                `).join('')}
                                ${student.passedResults.map(passed => `
                                    <div class="quiz-result">
                                        Quiz: ${passed.quizId} - Score: ${passed.score}% -
                                        <span class="passed">Passed</span> - Date: ${passed.date}
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    resultsContainer.appendChild(studentContainer);
                });
            } catch (error) {
                console.error('Error fetching updated dashboard:', error);
                alert('Unable to fetch the updated dashboard: ' + error.message);
            }
        }

        // Initial fetch when the page loads
        fetchUpdatedDashboardData();

        // Set up periodic refresh every 10 seconds (10000 ms)
        setInterval(fetchUpdatedDashboardData, 10000); // Refresh every 10 seconds
    </script>
</body>
</html>
